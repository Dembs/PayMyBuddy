<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Page Transfert</title>
</head>
<body>
<div class="nav-bar">
    <a th:href="@{/transfert}" class="active">Transférer</a>
    <a th:href="@{/profile}">Profil</a>
    <a th:href="@{/connections}">Ajouter Relation</a>
    <a th:href="@{/logout}">Se déconnecter</a>
</div>

<div class="container">

    <div class="balance-section">
        <h3>Solde du compte</h3>
        <p class="balance-amount" th:text="${#numbers.formatDecimal(balance, 1, 2) + ' €'}">0.00 €</p>
    </div>
    <div class="transfer-form">
        <h3>Effectuer une opération</h3>
        <form th:action="@{/transfert/add}" method="post">
            <div class="form-group">
                <label for="type">Type d'opération:</label>
                <select id="type" name="type" onchange="updateFormFields()">
                    <option value="TRANSFERT" selected>Transfert</option>
                    <option value="VIREMENT RENTRANT">Virement rentrant</option>
                    <option value="VIREMENT SORTANT">Virement sortant</option>
                </select>
            </div>

            <div id="connection-field" style="display:none">
                <label for="receiver">Destinataire:</label>
                <select id="receiver" name="receiverId">
                    <option value="">Sélectionnez une relation</option>
                    <th:block th:each="connection : ${user.connections}">
                        <option th:value="${connection.id}" th:text="${connection.getRealUsername()}"></option>
                    </th:block>
                </select>
            </div>

            <div id="description-field" class="form-group">
                <label for="description">Description:</label>
                <input type="text" id="description" name="description">
            </div>

            <div class="form-group">
                <label for="amount">Montant:</label>
                <input type="number"
                       id="amount"
                       name="amount"
                       step="0.01"
                       min="1.00"
                       value="0.00"
                       placeholder="0.00 €"
                       required
                       oninvalid="this.setCustomValidity('Le montant minimum est de 1€')"
                       oninput="this.setCustomValidity('')">
            </div>


            <button type="submit">Payer</button>
        </form>
    </div>
    <div class="transfert-list">
        <h3>Mes Transactions</h3>

        <div th:if="${#lists.isEmpty(transactions)}" class="no-connections">
            <p>Vous n'avez pas encore de transfert</p>
        </div>

        <table th:if="${!#lists.isEmpty(transactions)}" class="transfert-table">
            <thead>
            <tr>
                <th>Relations</th>
                <th>Description</th>
                <th>Date</th>
                <th>Montant</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="transaction : ${transactions}">

                <td th:text="${transaction.type.startsWith('VIREMENT') ?
                     'Ma banque' :
                     (user.getId() == transaction.getSender().getId() ?
                      transaction.getReceiver().getRealUsername() :
                      transaction.getSender().getRealUsername())}">
                </td>
                <td th:text="${transaction.description}"></td>
                <td th:text="${#dates.format(transaction.date,'dd/MM/yyyy HH:mm')}"></td>
                <td th:text="${#numbers.formatDecimal(transaction.amount, 1, 2,'POINT') + ' €'}"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        updateFormFields();
    });
    function updateFormFields() {
        const type = document.getElementById('type').value;
        const connectionField = document.getElementById('connection-field');
        const descriptionField = document.getElementById('description-field');

        if (type === 'TRANSFERT') {
            connectionField.style.display = 'block';
            descriptionField.style.display = 'block';
        } else if (type.includes('VIREMENT')) {
            connectionField.style.display = 'none';
            descriptionField.style.display = 'none';
            document.getElementById('description').value = type;
        }
    }
</script>
</html>